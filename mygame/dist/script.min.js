"use strict";var cont=document.getElementById("container"),maze=document.getElementById("maze"),thingie=document.getElementById("thingie"),home=document.getElementById("home"),emo=document.getElementById("emo"),bu=document.getElementById("bu"),bd=document.getElementById("bd"),bl=document.getElementById("bl"),br=document.getElementById("br"),step=20,size=20,bwidth=2,mazeHeight=200,mazeWidth=300,nogoX=[],nogoX2=[],nogoY=[],nogoY2=[],prevDist=2*mazeWidth,lastUD=0,lastLR=0,mThreshold=15,firstMove=!0,allowTilt=!0,sThreshold=15,scThreshold=20;genSides();for(var my=mazeHeight/step,mx=mazeWidth/step,grid=[],i=0;i<my;i++){for(var sg=[],a=0;a<mx;a++)sg.push({u:0,d:0,l:0,r:0,v:0});grid.push(sg)}var dirs=["u","d","l","r"],modDir={u:{y:-1,x:0,o:"d"},d:{y:1,x:0,o:"u"},l:{y:0,x:-1,o:"r"},r:{y:0,x:1,o:"l"}};genMaze(0,0,0),drawMaze();for(var barriers=document.getElementsByClassName("barrier"),b=0;b<barriers.length;b++)nogoX.push(barriers[b].offsetLeft),nogoX2.push(barriers[b].offsetLeft+barriers[b].clientWidth),nogoY.push(barriers[b].offsetTop),nogoY2.push(barriers[b].offsetTop+barriers[b].clientHeight);function keys(e){switch(e.code){case"ArrowUp":up();break;case"ArrowDown":down();break;case"ArrowLeft":left();break;case"ArrowRight":right();break;case"KeyW":up();break;case"KeyS":down();break;case"KeyA":left();break;case"KeyD":right()}}function up(){animKeys(bu),checkYboundry("u")&&(thingie.style.top=thingie.offsetTop-step+"px",updateEmo(!1))}function down(){animKeys(bd),checkYboundry("d")&&(thingie.style.top=thingie.offsetTop+step+"px",updateEmo(!1))}function left(){animKeys(bl),checkXboundry("l")&&(thingie.style.left=thingie.offsetLeft-step+"px"),updateEmo(!0)}function right(){animKeys(br),checkXboundry("r")&&(thingie.style.left=thingie.offsetLeft+step+"px"),updateEmo(!0)}function checkXboundry(e){for(var t=thingie.offsetLeft,o=thingie.offsetTop,s=[],n=Math.max(nogoX.length,nogoX2.length,nogoY.length,nogoY2.length),l=0,a=0;a<n;a++)l=0,(o<nogoY[a]||o>nogoY2[a]-size)&&(l=1),"r"===e&&(t<nogoX[a]-size||t>nogoX2[a]-size)&&(l=1),"l"===e&&(t<nogoX[a]||t>nogoX2[a])&&(l=1),s.push(l);return s.every(function(e){return 0<e})}function checkYboundry(e){for(var t=thingie.offsetLeft,o=thingie.offsetTop,s=[],n=Math.max(nogoX.length,nogoX2.length,nogoY.length,nogoY2.length),l=0,a=0;a<n;a++)l=0,(t<nogoX[a]||t>nogoX2[a]-size)&&(l=1),"u"===e&&(o<nogoY[a]||o>nogoY2[a])&&(l=1),"d"===e&&(o<nogoY[a]-size||o>nogoY2[a]-size)&&(l=1),s.push(l);return s.every(function(e){return 0<e})}function genSides(){var e=mazeHeight/step,t=Math.floor(Math.random()*e)*step,o=mazeHeight-step-t,s=document.createElement("div");s.style.top=step+"px",s.style.left=step+"px",s.style.height=t+"px";var n=document.createElement("div");n.style.top=t+2*step+"px",n.style.left=step+"px",n.style.height=o+"px";var l=document.createElement("div");l.style.top=step+"px",l.style.left=mazeWidth+step+"px",l.style.height=o+"px";var a=document.createElement("div");a.style.top=o+2*step+"px",a.style.left=mazeWidth+step+"px",a.style.height=t+"px",nogoX.push(0,mazeWidth+2*step,0,0,mazeWidth+step,mazeWidth+step),nogoX2.push(0+bwidth,mazeWidth+2*step+bwidth,step,step,mazeWidth+2*step,mazeWidth+2*step),nogoY.push(t+step,o+step,t+step,t+2*step,o+step,o+2*step),nogoY2.push(t+2*step,o+2*step,t+step+bwidth,t+2*step+bwidth,o+step+bwidth,o+2*step+bwidth),thingie.style.top=t+step+"px",thingie.style.left="0px",home.style.top=o+step+"px",home.style.left=mazeWidth+step+"px";for(var i=[s,n,l,a],r=0;r<i.length;r++)confSideEl(i[r]),maze.appendChild(i[r])}function confSideEl(e){e.setAttribute("class","barrier"),e.style.width=bwidth+"px"}function genMaze(e,t,o){for(var s=limShuffle(dirs,o),n=0;n<s.length;n++){var l=e+modDir[s[n]].x,a=t+modDir[s[n]].y;grid[t][e].v=1,0<=l&&l<mx&&0<=a&&a<my&&0===grid[a][l].v&&(grid[t][e][s[n]]=1,grid[a][l][modDir[s[n]].o]=1,genMaze(l,a,n))}}function drawMaze(){for(var e=0;e<mx;e++)for(var t=0;t<my;t++){drawLines(e,t,grid[t][e].l,grid[t][e].r,grid[t][e].u,grid[t][e].d)}}function drawLines(e,t,o,s,n,l){var a=(t+1)*step,i=(e+1)*step;if(0===o&&0<e){var r=document.createElement("div");r.style.left=i+"px",r.style.height=step+"px",r.style.top=a+"px",r.setAttribute("class","barrier"),r.style.width=bwidth+"px",maze.appendChild(r)}if(0===l&&t<my-1){var d=document.createElement("div");d.style.left=i+"px",d.style.height=bwidth+"px",d.style.top=a+step+"px",d.setAttribute("class","barrier"),d.style.width=step+bwidth+"px",maze.appendChild(d)}}function limShuffle(e,t){for(var o=e.slice(0,t),s=e.slice(t,e.length),n=s.length-1;0<n;n--){var l=Math.floor(Math.random()*(n+1)),a=[s[l],s[n]];s[n]=a[0],s[l]=a[1]}return o.concat(s)}function animKeys(e){"bu"===e.id&&(e.style.border="3px #fff solid",e.style.borderTop="1px #fff solid",e.style.borderBottom="4px #fff solid",e.style.transform="translateY(-2px)"),"bd"===e.id&&(e.style.border="3px #fff solid",e.style.borderBottom="1px #fff solid",e.style.borderTop="4px #fff solid",e.style.transform="translateY(2px)"),"bl"===e.id&&(e.style.border="3px #fff solid",e.style.borderLeft="1px #fff solid",e.style.borderRight="4px #fff solid",e.style.transform="translateX(-2px)"),"br"===e.id&&(e.style.border="3px #fff solid",e.style.borderRight="1px #fff solid",e.style.borderLeft="4px #fff solid",e.style.transform="translateX(2px)"),setTimeout(function(){e.style.border="2px #fff solid",e.style.borderTop="2px #fff solid",e.style.borderBottom="2px #fff solid",e.style.borderLeft="2px #fff solid",e.style.borderRight="2px #fff solid",e.style.transform="translateY(0px)",e.style.transform="translateX(0px)"},"150")}document.addEventListener("keydown",keys),bu.addEventListener("click",function(e){up(),firstMove=!0}),bd.addEventListener("click",function(e){down(),firstMove=!0}),bl.addEventListener("click",function(e){left(),firstMove=!0}),br.addEventListener("click",function(e){right(),firstMove=!0});var maxl=0,prevl=0;function updateEmo(e){e?(thingie.offsetLeft<maxl&&(emo.innerHTML="🙄"),thingie.offsetLeft<maxl-2*step&&(emo.innerHTML="😒"),thingie.offsetLeft<maxl-4*step&&(emo.innerHTML="😣"),thingie.offsetLeft<maxl-6*step&&(emo.innerHTML="🤬"),thingie.offsetLeft>prevl&&(emo.innerHTML="😐"),thingie.offsetLeft>=maxl&&(thingie.offsetLeft>.6*mazeWidth?emo.innerHTML="😀":emo.innerHTML="🙂",maxl=thingie.offsetLeft),0===thingie.offsetLeft&&(emo.innerHTML="😢"),thingie.offsetLeft>mazeWidth-step&&thingie.offsetTop===home.offsetTop&&(emo.innerHTML="🤗",home.innerHTML="🏠"),thingie.offsetLeft>mazeWidth&&(emo.innerHTML="",home.innerHTML="🥳"),prevl=thingie.offsetLeft):thingie.offsetLeft>mazeWidth-step&&thingie.offsetTop===home.offsetTop?emo.innerHTML="🤗":thingie.offsetLeft>mazeWidth-step&&thingie.offsetTop!=home.offsetTo&&(emo.innerHTML="🙄")}function tiltTimer(){allowTilt=!1,setTimeout(function(){allowTilt=!0},"200")}function handleOrientation(e){firstMove&&(lastUD=e.beta,lastLR=e.gamma,firstMove=!1),allowTilt&&(e.beta<lastUD-mThreshold&&(up(),tiltTimer()),e.beta>lastUD+mThreshold&&(down(),tiltTimer()),e.gamma<lastLR-mThreshold&&(left(),tiltTimer()),e.gamma>lastLR+mThreshold&&(right(),tiltTimer()))}window.addEventListener("deviceorientation",handleOrientation);var haveEvents="ongamepadconnected"in window,gp=[],allowU=!0,allowD=!0,allowL=!0,allowR=!0,allowAU=!0,allowAD=!0,allowAL=!0,allowAR=!0;function disconnectGamepad(){gp=[]}function connectGamepad(e){console.log("trying to connect"),gp[0]=e.gamepad,requestAnimationFrame(updateStatus)}function updateStatus(){haveEvents||scangamepads();for(var e=0;e<gp[0].buttons.length;e++)gp[0].buttons[12].pressed&&allowU&&(up(),gpTimer("u")),!1===gp[0].buttons[12].pressed&&(allowU=!0),gp[0].buttons[13].pressed&&allowD&&(down(),gpTimer("d")),!1===gp[0].buttons[13].pressed&&(allowD=!0),gp[0].buttons[14].pressed&&allowL&&(left(),gpTimer("l")),!1===gp[0].buttons[14].pressed&&(allowL=!0),gp[0].buttons[15].pressed&&allowR&&(right(),gpTimer("r")),!1===gp[0].buttons[15].pressed&&(allowR=!0);for(var t=0;t<gp[0].axes.length;t++)(gp[0].axes[1]<-.8||gp[0].axes[3]<-.8)&&allowAU&&(up(),gpATimer("u")),(.8<gp[0].axes[1]||.8<gp[0].axes[3])&&allowAD&&(down(),gpATimer("d")),(gp[0].axes[0]<-.8||gp[0].axes[2]<-.8)&&allowAL&&(left(),gpATimer("l")),(.8<gp[0].axes[0]||.8<gp[0].axes[2])&&allowAR&&(right(),gpATimer("r"));requestAnimationFrame(updateStatus)}function scangamepads(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)e[t]&&(e[t].index in gp?gp[e[t].index]=e[t]:addgamepad(e[t]))}function gpTimer(e){switch(e){case"u":allowU=!1;break;case"d":allowD=!1;break;case"l":allowL=!1;break;case"r":allowR=!1}setTimeout(function(){allowR=allowL=allowD=allowU=!0},"200")}function gpATimer(e){switch(e){case"u":allowAU=!1;break;case"d":allowAD=!1;break;case"l":allowAL=!1;break;case"r":allowAR=!1}setTimeout(function(){allowAR=allowAL=allowAD=allowAU=!0},"200")}window.addEventListener("gamepadconnected",connectGamepad),window.addEventListener("gamepaddisconnected",disconnectGamepad),haveEvents||setInterval(scangamepads,500);var lasttouchpY=0,lasttouchpX=0;cont.addEventListener("touchstart",function(e){lasttouchpY=e.changedTouches[0].pageY,lasttouchpX=e.changedTouches[0].pageX}),cont.addEventListener("touchmove",function(e){e.preventDefault();var t=e.changedTouches[0].pageY-lasttouchpY,o=e.changedTouches[0].pageX-lasttouchpX;sThreshold<t?(down(),lasttouchpY=e.changedTouches[0].pageY):t<-1*sThreshold&&(up(),lasttouchpY=e.changedTouches[0].pageY),sThreshold<o?(right(),lasttouchpX=e.changedTouches[0].pageX):o<-1*sThreshold&&(left(),lasttouchpX=e.changedTouches[0].pageX)});var lastscrollpY=0,lastscrollpX=0;cont.addEventListener("wheel",function(e){0<(lastscrollpY+=e.deltaY)&&e.deltaY<0&&(lastscrollpY=0),lastscrollpY<0&&0<e.deltaY&&(lastscrollpY=0),scThreshold<lastscrollpY&&(up(),lastscrollpY=0),lastscrollpY<-1*scThreshold&&(down(),lastscrollpY=0),0<(lastscrollpX+=e.deltaX)&&e.deltaX<0&&(lastscrollpX=0),lastscrollpX<0&&0<e.deltaX&&(lastscrollpX=0),scThreshold<lastscrollpX&&(left(),lastscrollpX=0),lastscrollpX<-1*scThreshold&&(right(),lastscrollpX=0)});
//# sourceMappingURL=script.min.js.map
